var Drag=function(t){function e(){t.call(this),this.mousePoint={sx:0,sy:0,tx:0,ty:0},this.perX=0,this.perY=0,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchPoint,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onTouchPoint=function(t){this.mousePoint.tx=this.x,this.mousePoint.ty=this.y,this.mousePoint.sx=t.stageX,this.mousePoint.sy=t.stageY},s.startDrag=function(t,e,i,s){this.rectangle={x:t,y:e,width:i,height:s},t>i&&(this.rectangle.x=i,this.rectangle.width=t),e>s&&(this.rectangle.y=s,this.rectangle.height=e),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},s.onTouchMove=function(t){var i=this.mousePoint.tx+(t.stageX-this.mousePoint.sx);i<this.rectangle.x&&(i=this.rectangle.x),i>this.rectangle.width&&(i=this.rectangle.width),this.perX=Math.abs(i/(this.rectangle.width-this.rectangle.x)),isNaN(this.perX)&&(this.perX=0),this.x=i;var s=this.mousePoint.ty+(t.stageY-this.mousePoint.sy);s<this.rectangle.y&&(s=this.rectangle.y),s>this.rectangle.height&&(s=this.rectangle.height),this.perY=Math.abs(s/(this.rectangle.height-this.rectangle.y)),isNaN(this.perY)&&(this.perY=0),this.y=s,this.dispatchEvent(new egret.Event(e.CHANGE,!0,!1,{perX:this.perX,perY:this.perY}))},s.stopDrag=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},e.CHANGE="DRAG_CHANGE",e}(egret.Sprite);egret.registerClass(Drag,"Drag");var Hits=function(){function t(){}var e=(__define,t);e.prototype;return t.hitObject=function(t,e){var i=t,s=i.x,n=i.y,o=i.width,r=i.height,h=e,a=h.x,E=h.y,u=h.width,c=h.height;return s>=a&&s>=a+u?!1:a>=s&&a>=s+o?!1:n>=E&&n>=E+c?!1:E>=n&&E>=n+r?!1:!0},t.hitPoint=function(t,e,i){var s=e,n=i,o=t.x,r=t.y,h=t.width,a=t.height;return s>=o&&o+h>=s&&n>=r&&r+a>=n?!0:!1},t}();egret.registerClass(Hits,"Hits");var Notifier=function(){function t(){}var e=(__define,t),i=e.prototype;return i.listen=function(e,i,s){t.globalDispatch.addEventListener(e,i,s)},i.call=function(e,i){void 0===i&&(i=null),t.globalDispatch.dispatchEventWith(e,!1,i)},i.hasListen=function(e){return t.globalDispatch.hasEventListener(e)},t.globalDispatch=new egret.EventDispatcher,t}();egret.registerClass(Notifier,"Notifier");var RESGroup=function(t){function e(){t.apply(this,arguments),this.count=0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.load=function(t,e){void 0===t&&(t="resource/resource.json"),void 0===e&&(e="resource/"),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onConfigLoadErr,this),RES.loadConfig(t,e)},s.onConfigLoadErr=function(t){this.dispatchEvent(new egret.Event(e.ERROR,!1,!1,"加载配置文件失败"))},s.onConfigComplete=function(t){RES.getResAsync("resource",this.onGetResAsync,this)},s.onGetResAsync=function(t,e){this.group=t.groups,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadErr,this);for(var i=0;i<this.group.length;i++)RES.loadGroup(this.group[i].name,i)},s.onResourceLoadErr=function(t){console.log("加载资源组"+t.groupName+"失败"),this.dispatchEvent(new egret.Event(e.ERROR,!1,!1,"加载资源组"+t.groupName+"失败"))},s.onResourceLoadComplete=function(t){this.count+=1,console.log("加载资源组"+t.groupName+"成功"),console.log("加载资源组进度"+this.count/this.group.length),this.dispatchEvent(new egret.Event(e.PROGRESS,!1,!1,this.count/this.group.length)),this.count==this.group.length&&this.dispatchEvent(new egret.Event(e.COMPLETE))},e.COMPLETE="RESGROUP_COMPLETE",e.PROGRESS="RESGROUP_PROGRESS",e.ERROR="RESGROUP_ERROR",e}(egret.EventDispatcher);egret.registerClass(RESGroup,"RESGroup");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onToStage,this),e.stage=this.stage,this.regplugin()},s.regplugin=function(){new Loading,new Config},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Config=function(t){function e(){t.call(this),this.listen(e.LOAD_GROUP,this.loadRes,this),this.loadconfig()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.loadconfig=function(){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onConfigLoadErr,this),RES.loadConfig("resource/resource.json","resource/")},s.onConfigComplete=function(t){console.log("加载配置文件成功"),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.removeEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onConfigLoadErr,this),this.call(e.LOAD_GROUP,"logo")},s.onConfigLoadErr=function(t){console.log("加载配置文件失败")},s.loadRes=function(t){void 0===t&&(t=null),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadErr,this),RES.loadGroup(t.data,1)},s.onResourceLoadComplete=function(t){console.log("加载资源组成功"),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadErr,this),this.call(e.COMPLETE,t.groupName)},s.onResourceLoadErr=function(t){console.log("加载资源组失败")},s.onResourceProgress=function(t){this.call(e.PROGRESS,t.itemsLoaded/t.itemsTotal)},e.COMPLETE="CONFIG_COMPLETE",e.PROGRESS="CONFIG_PROGRESS",e.LOAD_GROUP="CONFIG_LOAD_GROUP",e}(Notifier);egret.registerClass(Config,"Config");var ConfigAll=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.resgroup=new RESGroup,this.resgroup.addEventListener(RESGroup.COMPLETE,this.onComplete,this),this.resgroup.addEventListener(RESGroup.ERROR,this.onError,this),this.resgroup.addEventListener(RESGroup.PROGRESS,this.onProgress,this),this.resgroup.load("resource/resource.json","resource/")},s.onError=function(t){console.log(t.data)},s.onProgress=function(t){this.call(e.PROGRESS,t.data)},s.onComplete=function(t){console.log("配置文件及资源加载成功"),this.resgroup.removeEventListener(RESGroup.COMPLETE,this.onComplete,this),this.resgroup.removeEventListener(RESGroup.ERROR,this.onError,this),this.resgroup.removeEventListener(RESGroup.PROGRESS,this.onProgress,this),this.call(e.COMPLETE)},e.COMPLETE="CONFIGALL_COMPLETE",e.PROGRESS="CONFIGALL_PROGRESS",e}(Notifier);egret.registerClass(ConfigAll,"ConfigAll");var Loading=function(t){function e(){t.call(this),this.listen(Config.PROGRESS,this.addUI,this),this.listen(Config.COMPLETE,this.removeUI,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addUI=function(t){void 0===t&&(t=null),null==this.ui&&(this.ui=new LoadingUI,this.ui.createUI()),this.ui.updata(t.data)},s.removeUI=function(t){void 0===t&&(t=null),this.ui&&(this.ui.deleteUI(),this.ui=null)},e}(Notifier);egret.registerClass(Loading,"Loading");var LoadingUI=function(t){function e(){t.apply(this,arguments),this.radius=0,this.lineSize=10}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createUI=function(t){void 0===t&&(t=200),this.radius=t,this.bg=new egret.Sprite,this.bg.graphics.lineStyle(this.lineSize,13421772),this.bg.graphics.drawArc(this.radius,this.radius,this.radius,0,2*Math.PI,!1),this.txt=new egret.TextField,this.txt.size=120,this.txt.bold=!0,this.txt.textColor=16724736,this.circle=new egret.Sprite,this.addChild(this.bg),this.addChild(this.circle),this.addChild(this.txt),this.x=(Main.stage.stageWidth-this.width)/2,this.y=(Main.stage.stageHeight-this.height)/2,Main.stage.addChild(this)},s.deleteUI=function(){this.removeChild(this.bg),this.removeChild(this.circle),this.removeChild(this.txt),this.bg=null,this.circle=null,this.txt=null,Main.stage.removeChild(this)},s.updata=function(t){this.circle.graphics.lineStyle(this.lineSize,16724736),this.circle.graphics.drawArc(this.radius,this.radius,this.radius,0,2*t*Math.PI,!1),this.txt.text=Math.ceil(100*t).toString()+"%",this.txt.x=(this.width-this.txt.width)/2,this.txt.y=(this.height-this.txt.height)/2},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");